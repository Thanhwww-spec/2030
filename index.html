<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>ESP32 DHT11 + LED</title>
<style>
  body { font-family: Arial; padding: 16px; }
  button { padding: 10px 16px; margin: 6px; font-size: 16px; }
  .big { font-size: 28px; }
</style>
</head>
<body>

<h2>ESP32 DHT11 + Äiá»u khiá»ƒn LED</h2>

<button onclick="connect()">Káº¿t ná»‘i ESP32</button>
<br><br>

<div>
  ğŸŒ¡ Nhiá»‡t Ä‘á»™: <span class="big" id="temp">--</span> Â°C<br>
  ğŸ’§ Äá»™ áº©m: <span class="big" id="hum">--</span> %
</div>

<br>

<button onclick="ledOn()">Báº¬T LED</button>
<button onclick="ledOff()">Táº®T LED</button>

<script>
const SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
const CHAR_SENSOR  = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';
const CHAR_LED     = '6e400004-b5a3-f393-e0a9-e50e24dcca9e';

let charSensor, charLed;

async function connect() {
  const device = await navigator.bluetooth.requestDevice({
    filters: [{ name: 'ESP32-DHT11-LED' }],
    optionalServices: [SERVICE_UUID]
  });

  const server = await device.gatt.connect();
  const service = await server.getPrimaryService(SERVICE_UUID);

  charSensor = await service.getCharacteristic(CHAR_SENSOR);
  charLed    = await service.getCharacteristic(CHAR_LED);

  await charSensor.startNotifications();
  charSensor.addEventListener(
    'characteristicvaluechanged', e => {
      const txt = new TextDecoder().decode(e.target.value);
      const data = JSON.parse(txt);
      document.getElementById('temp').innerText = data.t;
      document.getElementById('hum').innerText  = data.h;
    }
  );

  alert("ÄÃ£ káº¿t ná»‘i ESP32");
}

function ledOn() {
  if (charLed) charLed.writeValue(new TextEncoder().encode("ON"));
}

function ledOff() {
  if (charLed) charLed.writeValue(new TextEncoder().encode("OFF"));
}
</script>

</body>
</html>
